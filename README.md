# PDF 해상도 스케일러

PDF 파일을 원하는 해상도로 자동 변환하고 여러 파일을 병합하는 웹 애플리케이션입니다.

## 기술 스택

- **Frontend**: Next.js 14 (App Router), TypeScript
- **UI**: Chakra UI 2
- **PDF 처리**: pdf-lib
- **드래그 앤 드롭**: @dnd-kit
- **Database**: PostgreSQL (선택적 - 변환 히스토리 저장)

## 주요 기능

### 1. 단일 PDF 해상도 변환 (`/`)
- PDF 파일 업로드
- 원본 해상도 자동 감지
- 원하는 해상도로 변환 (1920px, 2560px, 3840px 또는 커스텀)
- 모든 요소(텍스트, 이미지, 벡터 그래픽) 비율에 맞춰 확대/축소
- 변환된 PDF 다운로드

### 2. 여러 PDF 병합 & 스케일 (`/merge`)
- 여러 PDF 파일 동시 업로드
- 드래그 앤 드롭으로 순서 변경
- 각 PDF의 원본 해상도 표시
- 모든 PDF를 동일한 해상도로 자동 변환
- 하나의 PDF로 병합

### 3. PDF 페이지 순서 변경 (`/reorder`) ⭐ NEW
- 한 PDF 파일 내의 페이지 순서를 자유롭게 변경
- 드래그 앤 드롭으로 직관적인 순서 조정
- 불필요한 페이지 제거 기능
- 페이지별 해상도 정보 표시
- 변경사항 실시간 추적
- 초기화 기능으로 원본 순서 복원

### 4. PDF 페이지 해상도 정규화 (`/normalize`)
- 한 PDF 내에서 페이지마다 다른 해상도 감지
- 모든 페이지의 해상도를 자동 분석 및 표시
- 페이지별 해상도 정보 테이블 제공
- 기준 해상도 선택 (첫 페이지, 가장 큰 페이지, 가장 작은 페이지, 커스텀)
- 모든 페이지를 하나의 통일된 해상도로 변환
- 페이지 내용 비율 유지

### 5. 변환 히스토리 (`/history`)
- 변환 기록 저장 (PostgreSQL)

## 설치 방법

1. 의존성 설치:
```bash
npm install
```

2. 환경 변수 설정:
`.env.local` 파일을 생성하고 PostgreSQL 연결 정보를 입력합니다:
```
DATABASE_URL=postgresql://postgres:postgres@localhost:5432/pdf_scaler
```

3. PostgreSQL 데이터베이스 생성 (선택적):
```bash
# PostgreSQL에 접속
psql -U postgres

# 데이터베이스 생성
CREATE DATABASE pdf_scaler;
```

4. 개발 서버 실행:
```bash
npm run dev
```

5. 브라우저에서 접속:
```
http://localhost:3000
```

## 사용 방법

### 단일 PDF 변환 (메인 페이지)
1. "PDF 파일 선택" 버튼을 클릭하여 PDF 파일을 선택합니다
2. 타겟 해상도를 선택합니다 (1920px, 2560px, 3840px 또는 커스텀)
3. "해상도 변환 시작" 버튼을 클릭합니다
4. 변환이 완료되면 "변환된 PDF 다운로드" 버튼으로 다운로드합니다

### 여러 PDF 병합 (`/merge` 페이지)
1. "여러 PDF 병합" 버튼을 클릭하거나 `/merge`로 이동합니다
2. "PDF 파일 추가" 버튼을 클릭하여 여러 PDF 파일을 선택합니다
3. 파일 목록에서 드래그하여 순서를 조정합니다
4. 타겟 해상도를 선택합니다
5. "해상도 변환 후 병합하기" 버튼을 클릭합니다
6. 병합이 완료되면 "병합된 PDF 다운로드" 버튼으로 다운로드합니다

### 페이지 순서 변경 (`/reorder` 페이지) ⭐ NEW
1. "페이지 순서 변경" 버튼을 클릭하거나 `/reorder`로 이동합니다
2. PDF 파일을 선택하면 모든 페이지가 목록으로 표시됩니다
3. ☰ 아이콘을 드래그하여 페이지 순서를 원하는 대로 변경합니다
4. ✕ 버튼을 클릭하여 불필요한 페이지를 제거합니다
5. "순서 변경 적용" 버튼을 클릭합니다
6. 재정렬된 PDF를 다운로드합니다

### 페이지 해상도 정규화 (`/normalize` 페이지)
1. "해상도 통일" 버튼을 클릭하거나 `/normalize`로 이동합니다
2. PDF 파일을 선택하면 모든 페이지의 해상도가 자동으로 분석됩니다
3. 페이지별 해상도 정보가 테이블로 표시됩니다
4. 페이지마다 해상도가 다르면 경고 메시지와 함께 목록이 표시됩니다
5. 기준 해상도를 선택합니다:
   - 첫 번째 페이지 해상도
   - 가장 큰 페이지 해상도
   - 가장 작은 페이지 해상도
   - 커스텀 (너비 x 높이 직접 입력)
6. "페이지 해상도 통일하기" 버튼을 클릭합니다
7. 모든 페이지가 통일된 해상도로 변환된 PDF를 다운로드합니다

## 프로젝트 구조

```
.
├── app/
│   ├── api/
│   │   ├── scale-pdf/
│   │   │   └── route.ts         # 단일 PDF 스케일링 API
│   │   ├── merge-pdf/
│   │   │   └── route.ts         # 여러 PDF 병합 API
│   │   ├── reorder-pdf/
│   │   │   └── route.ts         # 페이지 순서 변경 API
│   │   ├── normalize-pdf/
│   │   │   └── route.ts         # 페이지 해상도 정규화 API
│   │   └── history/
│   │       └── route.ts         # 히스토리 조회 API
│   ├── merge/
│   │   └── page.tsx             # PDF 병합 페이지
│   ├── reorder/
│   │   └── page.tsx             # 페이지 순서 변경 페이지
│   ├── normalize/
│   │   └── page.tsx             # 페이지 정규화 페이지
│   ├── history/
│   │   └── page.tsx             # 히스토리 페이지
│   ├── layout.tsx               # 루트 레이아웃
│   ├── page.tsx                 # 메인 페이지
│   └── providers.tsx            # Chakra UI Provider
├── lib/
│   └── db.ts                    # PostgreSQL 연결 및 쿼리
├── scripts/
│   └── init-db.ts               # DB 초기화
├── package.json
├── tsconfig.json
└── next.config.js
```

## 스케일링 로직

PDF 파일의 각 페이지에 대해 다음 작업을 수행합니다:

1. 원본 페이지 크기 자동 감지
2. 스케일 비율 계산 (target_width / source_width)
3. 페이지 크기를 새로운 크기로 변경
4. 모든 콘텐츠에 스케일 변환 행렬 적용
5. 콘텐츠 위치 조정

이를 통해 텍스트, 이미지, 벡터 그래픽 등 모든 요소가 비율에 맞춰 정확히 확대/축소됩니다.

## 병합 로직

여러 PDF를 병합할 때:

1. 각 PDF의 원본 해상도를 자동 감지
2. 모든 PDF를 선택한 타겟 해상도로 개별 변환
3. 사용자가 지정한 순서대로 페이지를 병합
4. 하나의 통합된 PDF 문서로 생성

## 페이지 순서 변경 로직

한 PDF 내 페이지 순서를 변경할 때:

1. PDF의 모든 페이지를 분석하여 목록 생성
2. 사용자가 드래그 앤 드롭으로 순서 변경
3. 불필요한 페이지 제거 가능
4. 새로운 순서대로 페이지를 복사
5. 새로운 PDF 문서 생성

## 정규화 로직

한 PDF 내 페이지 해상도를 통일할 때:

1. PDF의 모든 페이지 해상도를 분석
2. 페이지별 해상도를 테이블로 표시
3. 다양한 해상도가 있으면 경고 표시
4. 기준 해상도 선택 (첫 페이지/가장 큰/가장 작은/커스텀)
5. 각 페이지를 기준 해상도에 맞춰 개별 스케일링
6. 모든 페이지가 통일된 해상도의 PDF로 생성

## 주의사항

- PostgreSQL이 설치되어 있지 않아도 기본 기능은 작동합니다 (히스토리 저장만 실패)
- 큰 PDF 파일은 처리 시간이 오래 걸릴 수 있습니다
- 브라우저에서 처리하므로 파일 크기 제한이 있을 수 있습니다

## 라이센스

MIT
